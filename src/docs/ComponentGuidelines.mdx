import { Meta } from '@storybook/addon-docs/blocks';

<Meta title="Documentation/Component Guidelines" />

# Component Guidelines

Overview of component types and the islands architecture pattern used in RBAC UI.

For detailed guidance, see the focused docs:
- [PatternFly Patterns](?path=/docs/documentation-patternfly-patterns--docs) — imports, icons, i18n
- [TableView](?path=/docs/documentation-tableview--docs) — table component and `useTableState`
- [Storybook Mandatory Rules](?path=/docs/documentation-storybookmandatoryrules--docs) — mandatory story rules

---

## Component Types

### Features
**Location**: `src/features/`

Route/page-level containers. Tied to a specific URL. They orchestrate data fetching via React Query hooks, manage state, and compose presentational components and shared components.

- Contains business logic and side effects
- Uses React Query hooks for API interactions (`useQuery`, `useMutation`)
- Context-aware and feature-specific
- **Exports**: named + default (both are allowed)

```tsx
// WorkspacesList.tsx — feature container
export const WorkspacesList: React.FC = () => {
  const { data: workspaces, isLoading } = useWorkspacesQuery();
  return <WorkspacesTable workspaces={workspaces?.data ?? []} isLoading={isLoading} />;
};
export default WorkspacesList;
```

### Shared Components
**Location**: `src/components/`

Reusable UI elements not tied to a specific feature. Can be used in multiple features.

- No business logic
- Receive all data via props
- **Exports**: named only (no default export)

```tsx
// src/components/table-view/TableView.tsx — shared component
export function TableView<TColumns, TRow, TSortable>(...) { ... }
// No default export
```

### Presentational Components (Legacy)
**Location**: `src/presentational-components/`

Older pure UI components being migrated to `src/features/` or `src/components/`. New code does not go here.

---

## Feature Islands Pattern

Identify whether something is a **Feature** (route-tied) or a **Component** (reusable):

**Feature checklist** — if YES to most, it's a feature:
- [ ] Tied to a specific route/URL?
- [ ] Acts as a page container?
- [ ] Referenced in routing configuration?
- [ ] Orchestrates multiple smaller components?

### File Organization

```
src/features/workspaces/
├── WorkspacesList.tsx               # Feature — named + default exports
├── workspace-detail/
│   ├── WorkspaceDetail.tsx          # Feature — named + default exports
│   └── components/                  # Reusable within this feature
│       ├── GroupsDrawer.tsx         # Component — named export only
│       ├── GroupsDrawer.stories.tsx
│       └── RoleAccessModal.tsx      # Component — named export only
└── WorkspacesList.stories.tsx
```

### Export Rules

```typescript
// Feature (route/page) — both exports
export const WorkspacesList = () => { ... };
export default WorkspacesList;

// Component — named export only
export const GroupsDrawer: React.FC<Props> = ({ ... }) => { ... };
// No default export

// Stories — always import components using named exports
import { GroupsDrawer } from './GroupsDrawer';   // ✅
import GroupsDrawer from './GroupsDrawer';        // ❌
```

---

## React Query Pattern

Smart components use React Query for data fetching. No direct Redux dispatch for API calls in new code.

```tsx
export const UserList: React.FC = () => {
  const { data: users, isLoading } = useUsersQuery();
  const deleteUserMutation = useDeleteUserMutation();

  const handleDelete = useCallback(
    (userId: string) => deleteUserMutation.mutate(userId),
    [deleteUserMutation],
  );

  return (
    <TableView
      data={users?.data ?? []}
      isLoading={isLoading}
      // ... rest of props
    />
  );
};
```

---

## Storybook Requirements

Every component in `src/features/` or `src/components/` that is modified or added requires a `.stories.tsx` update. Route-level features (modals tied to routes, new pages) require user-journey stories with `fn()` API spies.

See [StorybookMandatoryRules](?path=/docs/documentation-storybookmandatoryrules--docs) for the complete story checklist.

---

## Resources

- [Architecture](?path=/docs/documentation-architecture--docs) — technical architecture overview
- [Development Workflow](?path=/docs/documentation-development-workflow--docs) — JS→TS conversion, validation
- [PatternFly Patterns](?path=/docs/documentation-patternfly-patterns--docs) — imports, i18n, empty states
- [TableView](?path=/docs/documentation-tableview--docs) — canonical table implementation
