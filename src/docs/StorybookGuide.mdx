import { Meta } from '@storybook/addon-docs/blocks';

<Meta title="Documentation/Storybook Guide" />

# Storybook Guide

RBAC UI uses Storybook 9.x with React and Webpack 5 as the primary development and testing environment.

For writing stories, consult the focused docs:
- [Storybook Mandatory Rules](?path=/docs/documentation-storybookmandatoryrules--docs) — rules that apply to every `.stories.tsx` file
- [Storybook Patterns](?path=/docs/documentation-storybookpatterns--docs) — how-to patterns (modals, feature flags, empty states, containers)
- [User Journeys](?path=/docs/documentation-user-journeys--docs) — end-to-end user workflow stories

---

## Setup

```bash
npm run storybook        # Start dev server
npm run build-storybook  # Build static Storybook
npm run test-storybook:ci  # Run all play function tests
```

Test specific stories by tag:
```bash
npm run test-storybook:ci -- --includeTags="my-feature"
```

---

## Configuration

**Framework**: `@storybook/react-webpack5` with SWC compiler  
**Stories location**: All `*.stories.@(js|jsx|ts|tsx)` under `src/`  
**Documentation**: MDX files in `src/docs/`  
**Static assets**: `./static`

### Context Providers

All stories are automatically wrapped with:
- `IntlProvider` — i18n with locale data from `src/locales/data.json`
- `PermissionsContext` — user access control simulation
- `ChromeProvider` — Red Hat Cloud Services chrome environment
- `FeatureFlagsProvider` — feature flag testing

### Default Parameters

```typescript
parameters: {
  permissions: {
    userAccessAdministrator: false,
    orgAdmin: false,
  },
  chrome: {
    environment: 'prod',
  },
  featureFlags: {
    'platform.rbac.itless': false,
  },
}
```

Override per story or per meta using `parameters` or `args`.

### MSW Integration

All stories have MSW available via `mswLoader`. Use `parameters.msw.handlers` to mock API responses in container stories.

### Hook Mocking

Development-specific mock implementations:
- `@redhat-cloud-services/frontend-components/useChrome` → `.storybook/hooks/useChrome`
- `@unleash/proxy-client-react` → `.storybook/hooks/unleash`

---

## Story Organization

Stories are auto-titled from file paths — never set a custom `title` in meta.

| File path | Auto-generated title |
|-----------|---------------------|
| `src/features/workspaces/WorkspacesList.stories.tsx` | Features/Workspaces/Workspaces List |
| `src/components/table-view/TableView.stories.tsx` | Components/Table View/Table View |
| `src/docs/Introduction.mdx` | Documentation/Introduction |

Group related stories in logical directory structures for good auto-titles.

---

## Testing Configuration

- **Timeout**: 20 seconds per story
- **Error detection**: Console errors fail stories automatically
- **Skip tag**: Stories tagged `skip-test` are excluded from test runs
- **MSW**: Works in test runner via `mswLoader`

---

## Story Types at a Glance

| Type | Tags on meta | Default story | Other stories |
|------|-------------|---------------|---------------|
| Presentational | `['autodocs']` | Standard | Standard |
| Container | `['container-name']` (no autodocs) | `tags: ['autodocs']` + directory | MSW only, no docs |

Container stories use the **single autodocs pattern** to prevent MSW handler conflicts. Only the Default story renders in autodocs — other stories link from the Default story description.
